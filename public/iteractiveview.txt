<html lang="en"><head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Portfolio | Open World 3D</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&amp;display=swap" rel="stylesheet">
<style>
body {
font-family: 'Inter', sans-serif;
background-color: #09090b;
overflow: hidden;
touch-action: none;
}
#canvas-container {
width: 100%;
height: 100%;
display: block;
}
.modal-panel {
transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
backdrop-filter: blur(12px);
}
.key-cap {
box-shadow: 0 4px 0 #27272a;
transition: all 0.1s;
}
.key-cap:active, .key-cap.pressed {
transform: translateY(4px);
box-shadow: 0 0 0 #27272a;
}
.world-label {
position: absolute;
transform: translate(-50%, -50%);
pointer-events: none;
transition: opacity 0.3s;
z-index: 10;
}
</style></head>
<body class="bg-zinc-950 text-zinc-300 antialiased h-screen w-screen overflow-hidden">

    <!-- UI LAYER -->
    <div class="fixed inset-0 z-50 pointer-events-none flex flex-col justify-between p-6 sm:p-8">
        
        <!-- Header -->
        <div class="flex justify-between items-start w-full">
            <div class="flex flex-col gap-1 pointer-events-auto">
                <div class="flex items-center gap-2">
                    <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></div>
                    <h1 class="text-xs font-semibold tracking-tight text-white uppercase">Alex.OS [City_Build]</h1>
                </div>
                <div class="text-[10px] text-zinc-500 tracking-wide font-mono" id="coords">POS: 0, 0</div>
            </div>

            <!-- Hint -->
            <div class="bg-zinc-900/90 backdrop-blur border border-white/5 rounded-lg p-3 max-w-[200px] text-right pointer-events-auto hidden md:block shadow-lg">
                <p class="text-[10px] uppercase text-zinc-500 tracking-widest mb-2 font-medium">Drive Control</p>
                <div class="flex justify-end gap-1 mb-1">
                    <div class="w-7 h-7 rounded bg-zinc-800 border border-white/5 flex items-center justify-center text-[10px] font-bold text-zinc-300 key-cap" id="key-w">W</div>
                </div>
                <div class="flex justify-end gap-1">
                    <div class="w-7 h-7 rounded bg-zinc-800 border border-white/5 flex items-center justify-center text-[10px] font-bold text-zinc-300 key-cap" id="key-a">A</div>
                    <div class="w-7 h-7 rounded bg-zinc-800 border border-white/5 flex items-center justify-center text-[10px] font-bold text-zinc-300 key-cap" id="key-s">S</div>
                    <div class="w-7 h-7 rounded bg-zinc-800 border border-white/5 flex items-center justify-center text-[10px] font-bold text-zinc-300 key-cap" id="key-d">D</div>
                </div>
            </div>
        </div>

        <!-- Proximity Action -->
        <div id="proximity-alert" class="absolute top-2/3 left-1/2 -translate-x-1/2 -translate-y-1/2 opacity-0 transition-all duration-300 transform scale-90 pointer-events-none flex flex-col items-center">
            <div class="bg-white text-black px-4 py-2.5 rounded-full text-xs font-semibold tracking-wide flex items-center gap-2 shadow-[0_0_30px_rgba(255,255,255,0.3)]">
                <span class="iconify animate-bounce" data-icon="lucide:arrow-down" data-width="14"></span>
                Press ENTER to Open
            </div>
        </div>

        <!-- Mobile Controls -->
        <div class="md:hidden flex justify-between items-end w-full pb-4 pointer-events-auto">
            <div class="flex gap-3">
                <button id="btn-left" class="w-16 h-16 rounded-full bg-zinc-900/80 border border-white/10 active:bg-white/10 backdrop-blur flex items-center justify-center">
                    <span class="iconify text-white" data-icon="lucide:arrow-left" data-width="24"></span>
                </button>
                <button id="btn-right" class="w-16 h-16 rounded-full bg-zinc-900/80 border border-white/10 active:bg-white/10 backdrop-blur flex items-center justify-center">
                    <span class="iconify text-white" data-icon="lucide:arrow-right" data-width="24"></span>
                </button>
            </div>
            <div class="flex flex-col gap-3">
                 <button id="btn-gas" class="w-16 h-16 rounded-full bg-zinc-900/80 border border-white/10 active:bg-white/10 backdrop-blur flex items-center justify-center">
                    <span class="iconify text-white" data-icon="lucide:arrow-up" data-width="24"></span>
                </button>
                <button id="btn-brake" class="w-16 h-16 rounded-full bg-zinc-900/80 border border-white/10 active:bg-white/10 backdrop-blur flex items-center justify-center">
                    <span class="iconify text-white" data-icon="lucide:arrow-down" data-width="24"></span>
                </button>
            </div>
        </div>
    </div>

    <!-- 3D CANVAS -->
    <div id="canvas-container" class="relative z-0"></div>

    <!-- LABELS -->
    <div id="labels-container" class="absolute inset-0 pointer-events-none overflow-hidden z-10">
        <div id="label-about" class="world-label flex flex-col items-center gap-3 opacity-0">
            <div class="relative group">
                <div class="absolute -inset-2 bg-purple-500/30 rounded-full blur-md animate-pulse"></div>
                <div class="w-12 h-12 bg-zinc-900 border border-purple-500/50 rounded-full flex items-center justify-center relative z-10">
                    <span class="iconify text-purple-400" data-icon="lucide:user" data-width="20"></span>
                </div>
            </div>
            <div class="text-center">
                <div class="bg-zinc-900/80 backdrop-blur px-2 py-1 rounded border border-white/10">
                    <div class="text-[10px] font-bold text-white tracking-widest uppercase">About HQ</div>
                </div>
                <div class="w-0.5 h-8 bg-gradient-to-b from-purple-500 to-transparent mx-auto mt-1"></div>
            </div>
        </div>
        
        <div id="label-experience" class="world-label flex flex-col items-center gap-3 opacity-0">
             <div class="relative group">
                <div class="absolute -inset-2 bg-blue-500/30 rounded-full blur-md animate-pulse"></div>
                <div class="w-12 h-12 bg-zinc-900 border border-blue-500/50 rounded-full flex items-center justify-center relative z-10">
                    <span class="iconify text-blue-400" data-icon="lucide:briefcase" data-width="20"></span>
                </div>
            </div>
            <div class="text-center">
                <div class="bg-zinc-900/80 backdrop-blur px-2 py-1 rounded border border-white/10">
                    <div class="text-[10px] font-bold text-white tracking-widest uppercase">Experience</div>
                </div>
                <div class="w-0.5 h-8 bg-gradient-to-b from-blue-500 to-transparent mx-auto mt-1"></div>
            </div>
        </div>

        <div id="label-portfolio" class="world-label flex flex-col items-center gap-3 opacity-0">
             <div class="relative group">
                <div class="absolute -inset-2 bg-emerald-500/30 rounded-full blur-md animate-pulse"></div>
                <div class="w-12 h-12 bg-zinc-900 border border-emerald-500/50 rounded-full flex items-center justify-center relative z-10">
                    <span class="iconify text-emerald-400" data-icon="lucide:layers" data-width="20"></span>
                </div>
            </div>
            <div class="text-center">
                <div class="bg-zinc-900/80 backdrop-blur px-2 py-1 rounded border border-white/10">
                    <div class="text-[10px] font-bold text-white tracking-widest uppercase">Projects</div>
                </div>
                <div class="w-0.5 h-8 bg-gradient-to-b from-emerald-500 to-transparent mx-auto mt-1"></div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="modal-container" class="fixed inset-0 z-[100] bg-black/60 backdrop-blur-md hidden flex items-center justify-center p-4">
        
        <div id="modal-about" class="modal-panel w-full max-w-2xl bg-zinc-950 border border-white/10 rounded-xl shadow-2xl overflow-hidden hidden transform scale-95 opacity-0">
            <div class="h-1 w-full bg-gradient-to-r from-purple-500 via-indigo-500 to-purple-500"></div>
            <div class="p-8">
                <div class="flex items-start justify-between mb-6">
                    <div>
                        <h2 class="text-xl font-semibold text-white tracking-tight">Alex Designer</h2>
                        <p class="text-xs text-zinc-500 mt-1 uppercase tracking-wider">Profile &amp; Bio</p>
                    </div>
                    <button class="close-modal text-zinc-500 hover:text-white transition-colors">
                        <span class="iconify" data-icon="lucide:x" data-width="20"></span>
                    </button>
                </div>
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="space-y-4 text-sm text-zinc-400 leading-relaxed">
                        <p>I build digital products that feel like magic. With a background in 3D interactions and clean typography, I bridge the gap between design and engineering.</p>
                    </div>
                    <div class="space-y-3">
                        <div class="bg-zinc-900 p-3 rounded border border-white/5 flex items-center gap-3">
                            <span class="iconify text-purple-400" data-icon="lucide:map-pin" data-width="16"></span>
                            <span class="text-xs text-zinc-300">San Francisco, CA</span>
                        </div>
                        <div class="bg-zinc-900 p-3 rounded border border-white/5 flex items-center gap-3">
                            <span class="iconify text-purple-400" data-icon="lucide:mail" data-width="16"></span>
                            <span class="text-xs text-zinc-300">hello@alex.design</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="modal-experience" class="modal-panel w-full max-w-2xl bg-zinc-950 border border-white/10 rounded-xl shadow-2xl overflow-hidden hidden transform scale-95 opacity-0">
            <div class="h-1 w-full bg-gradient-to-r from-blue-500 via-cyan-500 to-blue-500"></div>
            <div class="p-8">
                <div class="flex items-start justify-between mb-8">
                    <div>
                        <h2 class="text-xl font-semibold text-white tracking-tight">Career Log</h2>
                        <p class="text-xs text-zinc-500 mt-1 uppercase tracking-wider">Experience</p>
                    </div>
                    <button class="close-modal text-zinc-500 hover:text-white transition-colors">
                        <span class="iconify" data-icon="lucide:x" data-width="20"></span>
                    </button>
                </div>
                <div class="space-y-8">
                    <div class="relative pl-6 border-l border-zinc-800">
                        <div class="absolute -left-1.5 top-1 w-3 h-3 rounded-full bg-blue-500 ring-4 ring-zinc-950"></div>
                        <h3 class="text-sm font-semibold text-white">Senior Product Designer</h3>
                        <p class="text-[10px] text-blue-400 mb-1 uppercase tracking-wider font-mono">Stripe • 2021 - Present</p>
                        <p class="text-xs text-zinc-400 mt-2">Leading the design system team and crafting payment interfaces.</p>
                    </div>
                    <div class="relative pl-6 border-l border-zinc-800">
                        <div class="absolute -left-1.5 top-1 w-3 h-3 rounded-full bg-zinc-700 ring-4 ring-zinc-950"></div>
                        <h3 class="text-sm font-semibold text-white">Frontend Developer</h3>
                        <p class="text-[10px] text-zinc-500 mb-1 uppercase tracking-wider font-mono">Vercel • 2019 - 2021</p>
                        <p class="text-xs text-zinc-400 mt-2">Built dashboard components and deployment visualizations.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="modal-portfolio" class="modal-panel w-full max-w-3xl bg-zinc-950 border border-white/10 rounded-xl shadow-2xl overflow-hidden hidden transform scale-95 opacity-0">
            <div class="h-1 w-full bg-gradient-to-r from-emerald-500 via-green-500 to-emerald-500"></div>
            <div class="p-8">
                <div class="flex items-start justify-between mb-8">
                    <div>
                        <h2 class="text-xl font-semibold text-white tracking-tight">Project Showroom</h2>
                        <p class="text-xs text-zinc-500 mt-1 uppercase tracking-wider">Works</p>
                    </div>
                    <button class="close-modal text-zinc-500 hover:text-white transition-colors">
                        <span class="iconify" data-icon="lucide:x" data-width="20"></span>
                    </button>
                </div>
                <div class="grid sm:grid-cols-2 gap-6">
                    <div class="group relative aspect-[4/3] bg-zinc-900 rounded border border-white/5 overflow-hidden cursor-pointer hover:border-emerald-500/50 transition-colors">
                        <div class="absolute inset-0 bg-gradient-to-t from-zinc-950 to-transparent flex flex-col justify-end p-5 z-10">
                            <h4 class="text-sm font-medium text-white">Lumina Finance</h4>
                            <p class="text-xs text-zinc-500">Web3 Dashboard</p>
                        </div>
                        <div class="absolute inset-0 bg-zinc-800 group-hover:scale-105 transition-transform duration-700"></div>
                    </div>
                    <div class="group relative aspect-[4/3] bg-zinc-900 rounded border border-white/5 overflow-hidden cursor-pointer hover:border-emerald-500/50 transition-colors">
                        <div class="absolute inset-0 bg-gradient-to-t from-zinc-950 to-transparent flex flex-col justify-end p-5 z-10">
                            <h4 class="text-sm font-medium text-white">Orbit UI</h4>
                            <p class="text-xs text-zinc-500">Design System</p>
                        </div>
                        <div class="absolute inset-0 bg-zinc-800 group-hover:scale-105 transition-transform duration-700"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- THREE.JS SETUP ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        const fogColor = new THREE.Color('#09090b');
        scene.background = fogColor;
        scene.fog = new THREE.Fog(fogColor, 20, 80); // Fog for depth

        // Camera (Chase Cam)
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true, powerPreference: "high-performance" });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        container.appendChild(renderer.domElement);

        // --- LIGHTING ---
        const ambientLight = new THREE.HemisphereLight(0xffffff, 0x09090b, 0.4);
        scene.add(ambientLight);

        const dirLight = new THREE.DirectionalLight(0xffffff, 1);
        dirLight.position.set(50, 100, 50);
        dirLight.castShadow = true;
        dirLight.shadow.mapSize.width = 2048;
        dirLight.shadow.mapSize.height = 2048;
        dirLight.shadow.camera.near = 0.5;
        dirLight.shadow.camera.far = 200;
        dirLight.shadow.camera.left = -100;
        dirLight.shadow.camera.right = 100;
        dirLight.shadow.camera.top = 100;
        dirLight.shadow.camera.bottom = -100;
        scene.add(dirLight);

        // --- CITY GENERATION ---
        
        // Floor
        const planeGeometry = new THREE.PlaneGeometry(500, 500);
        const planeMaterial = new THREE.MeshStandardMaterial({ 
            color: 0x18181b, // Dark Asphalt
            roughness: 0.9,
            metalness: 0.1
        });
        const plane = new THREE.Mesh(planeGeometry, planeMaterial);
        plane.rotation.x = -Math.PI / 2;
        plane.receiveShadow = true;
        scene.add(plane);

        const cityGroup = new THREE.Group();
        scene.add(cityGroup);

        const buildings = [];
        const zoneLocs = [
            { x: 0, z: 0, r: 15 }, // Spawn
            { x: -30, z: -30, r: 10 }, // About
            { x: 30, z: -30, r: 10 }, // Experience
            { x: 0, z: 40, r: 10 }  // Portfolio
        ];

        function isSafeZone(x, z) {
            return zoneLocs.some(zone => {
                const dist = Math.hypot(x - zone.x, z - zone.z);
                return dist < zone.r;
            });
        }

        // Generate City Blocks
        const buildingGeo = new THREE.BoxGeometry(1, 1, 1);
        const buildingMat = new THREE.MeshStandardMaterial({ color: 0x27272a, roughness: 0.2 });
        const windowMat = new THREE.MeshBasicMaterial({ color: 0x52525b }); // Lights off
        
        for (let i = 0; i < 200; i++) {
            const x = (Math.random() - 0.5) * 160;
            const z = (Math.random() - 0.5) * 160;

            if (isSafeZone(x, z)) continue;

            // Snap to grid for "Streets" effect
            const gridX = Math.round(x / 8) * 8;
            const gridZ = Math.round(z / 8) * 8;
            
            // Random Height
            const h = Math.random() * 8 + 2;
            const w = Math.random() * 2 + 2;
            const d = Math.random() * 2 + 2;

            const mesh = new THREE.Mesh(buildingGeo, buildingMat);
            mesh.position.set(gridX, h/2, gridZ);
            mesh.scale.set(w, h, d);
            mesh.castShadow = true;
            mesh.receiveShadow = true;
            cityGroup.add(mesh);

            // Add "Windows" (Simple small cubes slightly extruded)
            if (Math.random() > 0.5) {
                const win = new THREE.Mesh(buildingGeo, new THREE.MeshBasicMaterial({ 
                    color: Math.random() > 0.8 ? 0xfef08a : 0x3f3f46, 
                    transparent: true, 
                    opacity: 0.8 
                }));
                win.position.set(gridX, h - 1, gridZ + (d/2 + 0.05));
                win.scale.set(w * 0.6, 0.5, 0.1);
                cityGroup.add(win);
            }
        }

        // Trees
        const treeMat = new THREE.MeshStandardMaterial({ color: 0x064e3b, roughness: 0.9 });
        const trunkMat = new THREE.MeshStandardMaterial({ color: 0x3f2e21 });
        const treeGeo = new THREE.ConeGeometry(1, 4, 8);
        const trunkGeo = new THREE.CylinderGeometry(0.2, 0.2, 1);

        for(let i=0; i<60; i++) {
            const x = (Math.random() - 0.5) * 140;
            const z = (Math.random() - 0.5) * 140;
            if (isSafeZone(x, z)) continue;
            
            // Offset from grid to be "sidewalk" trees
            const gridX = Math.round(x / 8) * 8 + 3; 
            const gridZ = Math.round(z / 8) * 8 + 3;

            const trunk = new THREE.Mesh(trunkGeo, trunkMat);
            trunk.position.set(gridX, 0.5, gridZ);
            trunk.castShadow = true;
            cityGroup.add(trunk);

            const leaves = new THREE.Mesh(treeGeo, treeMat);
            leaves.position.set(gridX, 2.5, gridZ);
            leaves.castShadow = true;
            cityGroup.add(leaves);
        }

        // Street Lights
        const poleGeo = new THREE.CylinderGeometry(0.05, 0.05, 4);
        const poleMat = new THREE.MeshStandardMaterial({ color: 0x52525b });
        const bulbGeo = new THREE.SphereGeometry(0.2);
        const bulbMat = new THREE.MeshBasicMaterial({ color: 0xffedd5 });

        for(let i=0; i<20; i++) {
             const x = (Math.random() - 0.5) * 100;
            const z = (Math.random() - 0.5) * 100;
            if (isSafeZone(x, z)) continue;

             const gridX = Math.round(x / 16) * 16 - 4; 
             const gridZ = Math.round(z / 16) * 16 - 4;

             const pole = new THREE.Mesh(poleGeo, poleMat);
             pole.position.set(gridX, 2, gridZ);
             cityGroup.add(pole);

             const bulb = new THREE.Mesh(bulbGeo, bulbMat);
             bulb.position.set(gridX, 4, gridZ);
             cityGroup.add(bulb);

             // Point light for realism
             const pl = new THREE.PointLight(0xffedd5, 0.5, 10);
             pl.position.set(gridX, 3.5, gridZ);
             cityGroup.add(pl);
        }


        // --- CAR SETUP ---
        const carGroup = new THREE.Group();

        // Car Body - Cyberpunk Style
        const chassisGeo = new THREE.BoxGeometry(1.6, 0.6, 3.2);
        const chassisMat = new THREE.MeshStandardMaterial({ color: 0x18181b, roughness: 0.2, metalness: 0.7 });
        const carChassis = new THREE.Mesh(chassisGeo, chassisMat);
        carChassis.position.y = 0.6;
        carChassis.castShadow = true;
        carGroup.add(carChassis);

        // Cabin
        const cabinGeo = new THREE.BoxGeometry(1.4, 0.5, 1.8);
        const cabinMat = new THREE.MeshStandardMaterial({ color: 0x09090b, roughness: 0.1, metalness: 0.9 });
        const cabin = new THREE.Mesh(cabinGeo, cabinMat);
        cabin.position.set(0, 1.1, -0.2);
        carGroup.add(cabin);

        // Glow Strips (Rear)
        const stripGeo = new THREE.BoxGeometry(1.4, 0.05, 0.05);
        const stripMat = new THREE.MeshBasicMaterial({ color: 0xef4444 });
        const rearStrip = new THREE.Mesh(stripGeo, stripMat);
        rearStrip.position.set(0, 0.7, 1.61);
        carGroup.add(rearStrip);
        
        // Headlights
        const hlGeo = new THREE.BoxGeometry(0.4, 0.1, 0.05);
        const hlMat = new THREE.MeshBasicMaterial({ color: 0xbfdbfe });
        const hlLeft = new THREE.Mesh(hlGeo, hlMat);
        hlLeft.position.set(-0.5, 0.6, -1.61);
        const hlRight = new THREE.Mesh(hlGeo, hlMat);
        hlRight.position.set(0.5, 0.6, -1.61);
        carGroup.add(hlLeft);
        carGroup.add(hlRight);

        // Spotlights
        const carSpotL = new THREE.SpotLight(0xbfdbfe, 3, 30, 0.5, 0.5, 1);
        carSpotL.position.set(-0.5, 0.6, -1.5);
        carSpotL.target.position.set(-0.5, 0, -10);
        carGroup.add(carSpotL);
        carGroup.add(carSpotL.target);

        const carSpotR = new THREE.SpotLight(0xbfdbfe, 3, 30, 0.5, 0.5, 1);
        carSpotR.position.set(0.5, 0.6, -1.5);
        carSpotR.target.position.set(0.5, 0, -10);
        carGroup.add(carSpotR);
        carGroup.add(carSpotR.target);

        // Wheels
        const wheelGeo = new THREE.CylinderGeometry(0.35, 0.35, 0.3, 16);
        const wheelMat = new THREE.MeshStandardMaterial({ color: 0x09090b });
        wheelGeo.rotateZ(Math.PI / 2);

        const w1 = new THREE.Mesh(wheelGeo, wheelMat); w1.position.set(0.8, 0.35, 1);
        const w2 = new THREE.Mesh(wheelGeo, wheelMat); w2.position.set(-0.8, 0.35, 1);
        const w3 = new THREE.Mesh(wheelGeo, wheelMat); w3.position.set(0.8, 0.35, -1);
        const w4 = new THREE.Mesh(wheelGeo, wheelMat); w4.position.set(-0.8, 0.35, -1);
        carGroup.add(w1, w2, w3, w4);

        scene.add(carGroup);

        // --- ZONES ---
        const zones = [
            { id: 'about', x: -30, z: -30, color: 0xa855f7 },
            { id: 'experience', x: 30, z: -30, color: 0x3b82f6 },
            { id: 'portfolio', x: 0, z: 40, color: 0x10b981 }
        ];

        zones.forEach(zone => {
            // Zone Ground Marker
            const geo = new THREE.RingGeometry(3, 3.2, 32);
            const mat = new THREE.MeshBasicMaterial({ color: zone.color, side: THREE.DoubleSide, transparent: true, opacity: 0.8 });
            const ring = new THREE.Mesh(geo, mat);
            ring.rotation.x = -Math.PI / 2;
            ring.position.set(zone.x, 0.1, zone.z);
            scene.add(ring);

            // Floating Particles or Light Beacon
            const beaconGeo = new THREE.CylinderGeometry(0.1, 0.1, 20, 8);
            const beaconMat = new THREE.MeshBasicMaterial({ color: zone.color, transparent: true, opacity: 0.2 });
            const beacon = new THREE.Mesh(beaconGeo, beaconMat);
            beacon.position.set(zone.x, 10, zone.z);
            scene.add(beacon);

            // Floor Light
            const pLight = new THREE.PointLight(zone.color, 1, 10);
            pLight.position.set(zone.x, 2, zone.z);
            scene.add(pLight);
        });

        // --- GAME LOGIC ---
        const state = {
            speed: 0,
            angle: Math.PI, // Face camera initially? No, let's face forward (0) is +Z usually, wait.
                            // In this scene, we want to drive AWAY from camera.
                            // Car Front is -Z local.
            angle: Math.PI, // Starting Rotation
            keys: { w: false, a: false, s: false, d: false },
            activeZone: null,
            modalOpen: false
        };

        const ACCELERATION = 0.02;
        const FRICTION = 0.96;
        const MAX_SPEED = 0.6;
        const ROTATION_SPEED = 0.05;

        // UI Refs
        const alertEl = document.getElementById('proximity-alert');
        const coordsEl = document.getElementById('coords');
        const modalContainer = document.getElementById('modal-container');

        // Input
        window.addEventListener('keydown', (e) => {
            if (state.modalOpen) {
                if(e.key === 'Escape') closeModal();
                return;
            }
            const k = e.key.toLowerCase();
            if (state.keys.hasOwnProperty(k)) state.keys[k] = true;
            const keyEl = document.getElementById(`key-${k}`);
            if(keyEl) keyEl.classList.add('pressed');

            if (e.key === 'Enter' && state.activeZone) {
                openModal(state.activeZone);
            }
        });

        window.addEventListener('keyup', (e) => {
            const k = e.key.toLowerCase();
            if (state.keys.hasOwnProperty(k)) state.keys[k] = false;
            const keyEl = document.getElementById(`key-${k}`);
            if(keyEl) keyEl.classList.remove('pressed');
        });

        const btnMap = { 'btn-gas': 'w', 'btn-brake': 's', 'btn-left': 'a', 'btn-right': 'd' };
        Object.entries(btnMap).forEach(([btnId, key]) => {
            const btn = document.getElementById(btnId);
            if(btn) {
                const press = (e) => { e.preventDefault(); state.keys[key] = true; };
                const release = (e) => { e.preventDefault(); state.keys[key] = false; };
                btn.addEventListener('touchstart', press);
                btn.addEventListener('touchend', release);
                btn.addEventListener('mousedown', press);
                btn.addEventListener('mouseup', release);
            }
        });

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        function updateLabels() {
            zones.forEach(zone => {
                const el = document.getElementById(`label-${zone.id}`);
                if (!el) return;

                const pos = new THREE.Vector3(zone.x, 3.5, zone.z);
                pos.project(camera);

                const x = (pos.x * 0.5 + 0.5) * window.innerWidth;
                const y = (-(pos.y * 0.5) + 0.5) * window.innerHeight;

                const dist = carGroup.position.distanceTo(new THREE.Vector3(zone.x, 0, zone.z));
                const maxDist = 40;

                if (pos.z < 1 && dist < maxDist) {
                    el.style.left = `${x}px`;
                    el.style.top = `${y}px`;
                    el.classList.remove('opacity-0');
                    // Scale effect based on distance
                    const scale = Math.max(0.7, 1 - dist/maxDist);
                    el.style.transform = `translate(-50%, -50%) scale(${scale})`;
                } else {
                    el.classList.add('opacity-0');
                }
            });
        }

        // --- ANIMATION LOOP ---
        function animate() {
            requestAnimationFrame(animate);

            if (!state.modalOpen) {
                // Physics
                if (state.keys.w) state.speed += ACCELERATION;
                if (state.keys.s) state.speed -= ACCELERATION;
                
                state.speed *= FRICTION;
                state.speed = Math.max(-MAX_SPEED, Math.min(MAX_SPEED, state.speed));

                // Steering (Inverted logic for reverse)
                if (Math.abs(state.speed) > 0.01) {
                    const direction = state.speed > 0 ? 1 : -1;
                    if (state.keys.a) state.angle += ROTATION_SPEED * direction;
                    if (state.keys.d) state.angle -= ROTATION_SPEED * direction;
                }

                // Move Car (Note: Car front is -Z in local space, so we use sin/cos appropriately)
                carGroup.rotation.y = state.angle;
                carGroup.position.x -= Math.sin(state.angle) * state.speed;
                carGroup.position.z -= Math.cos(state.angle) * state.speed;

                // --- CAMERA LOGIC (Third Person / Chase) ---
                // Calculate ideal camera position (Behind and Up)
                // Offset relative to car: 0 horizontal, 4 up, +8 back (since car moves -Z)
                const idealOffset = new THREE.Vector3(0, 5, 10);
                idealOffset.applyAxisAngle(new THREE.Vector3(0, 1, 0), state.angle);
                idealOffset.add(carGroup.position);

                // Smoothly interpolate current camera pos to ideal pos
                camera.position.lerp(idealOffset, 0.1);
                
                // Look slightly ahead of the car
                const lookAtPos = new THREE.Vector3(0, 0, -10);
                lookAtPos.applyAxisAngle(new THREE.Vector3(0, 1, 0), state.angle);
                lookAtPos.add(carGroup.position);
                camera.lookAt(lookAtPos);
            }

            // Proximity Check
            let nearbyZone = null;
            zones.forEach(zone => {
                const dist = Math.hypot(carGroup.position.x - zone.x, carGroup.position.z - zone.z);
                if (dist < 5) nearbyZone = zone.id;
            });

            if (nearbyZone !== state.activeZone) {
                state.activeZone = nearbyZone;
                if (nearbyZone) {
                    alertEl.classList.remove('opacity-0', 'scale-90', 'translate-y-4');
                    alertEl.classList.add('opacity-100', 'scale-100', 'translate-y-0');
                } else {
                    alertEl.classList.add('opacity-0', 'scale-90', 'translate-y-4');
                    alertEl.classList.remove('opacity-100', 'scale-100', 'translate-y-0');
                }
            }

            coordsEl.innerText = `X:${Math.round(carGroup.position.x)} Z:${Math.round(carGroup.position.z)}`;
            updateLabels();

            renderer.render(scene, camera);
        }

        // Modal Handlers
        function openModal(zoneId) {
            state.modalOpen = true;
            state.speed = 0;
            modalContainer.classList.remove('hidden');
            
            document.querySelectorAll('.modal-panel').forEach(p => {
                p.classList.add('hidden', 'opacity-0', 'scale-95');
            });

            const panel = document.getElementById(`modal-${zoneId}`);
            if (panel) {
                panel.classList.remove('hidden');
                setTimeout(() => {
                    panel.classList.remove('opacity-0', 'scale-95');
                    panel.classList.add('opacity-100', 'scale-100');
                }, 10);
            }
        }

        function closeModal() {
            const panels = document.querySelectorAll('.modal-panel:not(.hidden)');
            panels.forEach(p => {
                p.classList.remove('opacity-100', 'scale-100');
                p.classList.add('opacity-0', 'scale-95');
            });

            setTimeout(() => {
                modalContainer.classList.add('hidden');
                state.modalOpen = false;
            }, 300);
        }

        document.querySelectorAll('.close-modal').forEach(btn => btn.addEventListener('click', closeModal));

        // Start
        animate();

    </script>

</body></html>